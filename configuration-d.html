<!DOCTYPE html>
<html>
  <head>
    <title>Preferences</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" />
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
  </head>
  <body>
    <div data-role="page" id="main">
      <div data-role="header" class="jqm-header">
        <h1>Preferences</h1>
      </div>

      <div data-role="content">
        <fieldset data-role="unitgroup">
          <legend>Temperature Units:</legend>
          <input type="radio" name="units" id="units-si" value="si" />
          <label for="units-si">Celcius</label>
          <input type="radio" name="units" id="units-us" value="us" />
          <label for="units-us">Fahrenheit</label>
        </fieldset><br /> <br />
        <div id="inverter-toggle" style="display:none">
          <label for="inverter">Invert Colors</label>
          <input type="checkbox" data-role="flipswitch" name="inverter" id="inverter" ><br /> <br />
        </div>
        <div id="palettes">
        <label for="fg_color">Foreground Color:</label><br />
        <!-- Palette selector -->
        <!--?xml version="1.0" encdogin="utf-8"?-->
        <svg version="1.1" id="fg_color" class="color-picker" viewBox="0.0 0.0 270.0 120.0" width="200" fill="none" stroke="none" stroke-linecap="square" stroke-miterlimit="10" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <clipPath id="p.0"><path d="m0 0l270.0 0l0 120.0l-270.0 0l0 -120.0z" clip-rule="nonzero"></path></clipPath>
          <path fill="#000000" stroke="#ffffff" stroke-width="1.5" d="m3.8740158 3.5223098l62.425194 0l0 54.393703l-62.425194 0z" fill-rule="nonzero"></path>
          <path fill="#ffffff" stroke="#ffffff" stroke-width="1.5" d="m70.637794 3.5223098l62.425194 0l0 54.393703l-62.425194 0z" fill-rule="nonzero"></path>
          <path fill="#aaaaaa" stroke="#ffffff" stroke-width="1.5" d="m137.40158 3.5223098l62.425186 0l0 54.393703l-62.425186 0z" fill-rule="nonzero"></path>
          <path fill="#00aaaa" stroke="#ffffff" stroke-width="1.5" d="m204.02625 3.5223098l62.4252 0l0 54.393703l-62.4252 0z" fill-rule="nonzero"></path>
          <path fill="#55aaff" stroke="#ffffff" stroke-width="1.5" d="m3.8740158 61.527557l62.425194 0l0 54.3937l-62.425194 0z" fill-rule="nonzero"></path>
          <path fill="#ffffAA" stroke="#ffffff" stroke-width="1.5" d="m70.637794 61.527557l62.425194 0l0 54.3937l-62.425194 0z" fill-rule="nonzero"></path>
          <path fill="#ffaa00" stroke="#ffffff" stroke-width="1.5" d="m137.3307 61.527557l62.4252 0l0 54.3937l-62.4252 0z" fill-rule="nonzero"></path>
          <path fill="#55ffaa" stroke="#ffffff" stroke-width="1.5" d="m204.02362 61.527557l62.4252 0l0 54.3937l-62.4252 0z" fill-rule="nonzero"></path>
        </svg>
        <br /><br />

        <label for="bg_color">Background Color:</label><br />
        <!--?xml version="1.0" encdogin="utf-8"?-->
        <svg version="1.1" id="bg_color" class="color-picker" viewBox="0.0 0.0 270.0 120.0" width="200" fill="none" stroke="none" stroke-linecap="square" stroke-miterlimit="10" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <clipPath id="p.0"><path d="m0 0l270.0 0l0 120.0l-270.0 0l0 -120.0z" clip-rule="nonzero"></path></clipPath>
          <path fill="#000000" stroke="#ffffff" stroke-width="1.5" d="m3.8740158 3.5223098l62.425194 0l0 54.393703l-62.425194 0z" fill-rule="nonzero"></path>
          <path fill="#ffffff" stroke="#ffffff" stroke-width="1.5" d="m70.637794 3.5223098l62.425194 0l0 54.393703l-62.425194 0z" fill-rule="nonzero"></path>
          <path fill="#aaaaaa" stroke="#ffffff" stroke-width="1.5" d="m137.40158 3.5223098l62.425186 0l0 54.393703l-62.425186 0z" fill-rule="nonzero"></path>
          <path fill="#00aaaa" stroke="#ffffff" stroke-width="1.5" d="m204.02625 3.5223098l62.4252 0l0 54.393703l-62.4252 0z" fill-rule="nonzero"></path>
          <path fill="#55aaff" stroke="#ffffff" stroke-width="1.5" d="m3.8740158 61.527557l62.425194 0l0 54.3937l-62.425194 0z" fill-rule="nonzero"></path>
          <path fill="#ffffAA" stroke="#ffffff" stroke-width="1.5" d="m70.637794 61.527557l62.425194 0l0 54.3937l-62.425194 0z" fill-rule="nonzero"></path>
          <path fill="#ffaa00" stroke="#ffffff" stroke-width="1.5" d="m137.3307 61.527557l62.4252 0l0 54.3937l-62.4252 0z" fill-rule="nonzero"></path>
          <path fill="#55ffaa" stroke="#ffffff" stroke-width="1.5" d="m204.02362 61.527557l62.4252 0l0 54.3937l-62.4252 0z" fill-rule="nonzero"></path>
        </svg>
        <br /><br />
        </div>

        <fieldset class="ui-grid-a">
          <div class="ui-block-a"><button type="submit" data-theme="d" id="b-cancel">Cancel</button></div>
          <div class="ui-block-b"><button type="submit" data-theme="a" id="b-submit">Save</button></div>
        </fieldset>
    </div>

    <script>
      var options = {};

      function getUrlParameter(sParam, default_) {
        var sPageURL = window.location.search.substring(1);
        var sURLVariables = sPageURL.split('&');
        for (var i = 0; i < sURLVariables.length; i++) {
          var sParameterName = sURLVariables[i].split('=');
          if (sParameterName[0] == sParam) {
            return decodeURIComponent(sParameterName[1]);
          }
        }
        return default_;
      }          

      $().ready(function() {

        $('#b-cancel').click(function() {
          console.log('Cancel');
          var return_to = getUrlParameter('return_to', 'pebblejs://close');
          document.location = return_to;
        });

        $('#b-submit').click(function() {
         console.log("Submit");
         options["units"] = $('input:radio[name=units]:checked').val();
         options["invert"] = $("#inverter").is(":checked");
         console.log(encodeURIComponent(JSON.stringify(options)));
         var return_to = getUrlParameter('return_to', 'pebblejs://close#');
         document.location = return_to + encodeURIComponent(JSON.stringify(options));

        });

        function selectColor($path) {
          var hexValue = $path.attr('fill').replace('#', '');
          console.log ($path.parent().attr('id') + " " + hexValue);
          options[$path.parent().attr('id')] = hexValue;
          $path.parent().children().attr('stroke', '#fff').attr('stroke-width', '1.5');
          $path.attr('stroke', '#000').attr('stroke-width', '3');
          $path.parent().append($path);
        }

        $('.color-picker path').on('click', function() {
          selectColor($(this));
        });

       // Were we passed any values?
       if (getUrlParameter('units') == 'us') {
         $('input#units-us').prop("checked", "true").checkboxradio("refresh");
       } else {
         $('input#units-si').prop("checked", "true").checkboxradio("refresh");
       }
       if (getUrlParameter('invert').toLowerCase() == 'true') {
         $('#inverter').prop('checked', 'true').checkboxradio('refresh');
       }
       if (getUrlParameter('color') == 0) {
          $('#palettes').css('display',  'none');
          $('#inverter-toggle').css('display',  'inline');
       }
       options['fg_color'] = getUrlParameter('fg', 'ffffff');
       options['bg_color'] = getUrlParameter('bg', '000000');

      });

    </script>
  </body>
</html>
